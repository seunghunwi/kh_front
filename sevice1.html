<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>키워드로 장소검색하고 목록으로 표출하기</title>
    <link rel="stylesheet" href="CSS/style1.css">
    <link rel="stylesheet" href="CSS/style4.css">
</head>

<body style="background-image: url(/images/black-ge5793d1fd_1920.jpg); background-size:cover;">


    <div>
        <div>
            <nav class="navbar">
                <div class="navbar__logo">
                    <a href="https://www.naver.com/"><b>
                            <h1>DPO</h1>
                        </b></a>
                </div>
                <ul class="navbar__menu">
                    <li><a href="#"><b>주유소 조회</b></a></li>
                    <li><a href="#"><b>유가 예측</b></a></li>
                    <li><a href="#"><b>공지사항</b></a></li>
                </ul>
                <ul class="navbar__sns">
                    <li><a href="#"><i class="fa-thin fa-align-justify"><b>LOGIN</b></i></a></li>
                </ul>
            </nav>
            <hr>
        </div>
        <div id="st">
            <div id="center">
                <span style="color: black;">
                    <h1 style="text-align:center;">지역별</h1>
                </span>
                <hr>
                <span id="left">&nbsp;<b>지역</b></span><span>
                    <select onchange="categoryChange(this)">
                        <option value>시/도 선택</option>
                        <option value="general01">강원</option>
                        <option value="general02">경기</option>
                        <option value="general03">경남</option>
                        <option value="general04">경북</option>
                        <option value="general05">광주</option>
                        <option value="general06">대구</option>
                        <option value="general07">대전</option>
                        <option value="general08">부산</option>
                        <option value="general09">서울</option>
                        <option value="general10">울산</option>
                        <option value="general11">인천</option>
                        <option value="general12">전남</option>
                        <option value="general13">전북</option>
                        <option value="general14">제주</option>
                        <option value="general15">충남</option>
                        <option value="general16">충북</option>
                    </select>
                </span>

                <span class="search_box">
                    <select name="" id="state">
                        <option>군/구 선택</option>
                    </select>
                </span>
                <br>

                <!-- <input class = 'keyworld' type = 'text' name = 'search' maxlength = 255 value = "" autocomplte = "off"> 

      <button class = "img-button" type = "submit" name = "click" value="">
          <i class="fa-solid fa-magnifying-glass"></i>
      </button> -->
                <script>
                    function categoryChange(e) {
                        const state = document.getElementById("state");

                        const gangwon = ["강릉시", "동해시", "삼척시", "속초시", "원주시", "춘천시", "태백시", "고성군", "양구군", "양양군", "영월군", "인제군", "정선군", "철원군", "평창군", "홍천군", "화천군", "횡성군"];
                        const gyeonggi = ["고양시", "과천시", "광명시", "광주시", "구리시", "군포시", "김포시", "남양주시", "동두천시", "부천시", "성남시", "수원시", "시흥시", "안산시", "안성시", "안양시", "양주시", "오산시", "용인시", "의왕시", "의정부시", "이천시", "파주시", "평택시", "포천시", "하남시", "화성시", "가평군", "양평군", "여주군", "연천군"];
                        const gyeongsangnam = ["거제시", "김해시", "마산시", "밀양시", "사천시", "양산시", "진주시", "진해시", "창원시", "통영시", "거창군", "고성군", "남해군", "산청군", "의령군", "창녕군", "하동군", "함안군", "함양군", "합천군"];
                        const gyeongsangbuk = ["경산시", "경주시", "구미시", "김천시", "문경시", "상주시", "안동시", "영주시", "영천시", "포항시", "고령군", "군위군", "봉화군", "성주군", "영덕군", "영양군", "예천군", "울릉군", "울진군", "의성군", "청도군", "청송군", "칠곡군"];
                        const gwangju = ["광산구", "남구", "동구", "북구", "서구"];
                        const daegu = ["남구", "달서구", "동구", "북구", "서구", "수성구", "중구", "달성군"];
                        const daejeon = ["대덕구", "동구", "서구", "유성구", "중구"];
                        const busan = ["강서구", "금정구", "남구", "동구", "동래구", "부산진구", "북구", "사상구", "사하구", "서구", "수영구", "연제구", "영도구", "중구", "해운대구", "기장군"];
                        const seoul = ["강남구", "강동구", "강북구", "강서구", "관악구", "광진구", "구로구", "금천구", "노원구", "도봉구", "동대문구", "동작구", "마포구", "서대문구", "서초구", "성동구", "성북구", "송파구", "양천구", "영등포구", "용산구", "은평구", "종로구", "중구", "중랑구"];
                        const ulsan = ["남구", "동구", "북구", "중구", "울주군"];
                        const incheon = ["계양구", "남구", "남동구", "동구", "부평구", "서구", "연수구", "중구", "강화군", "옹진군"];
                        const jeonnam = ["광양시", "나주시", "목포시", "순천시", "여수시", "강진군", "고흥군", "곡성군", "구례군", "담양군", "무안군", "보성군", "신안군", "영광군", "영암군", "완도군", "장성군", "장흥군", "진도군", "함평군", "해남군", "화순군"];
                        const jeonbuk = ["군산시", "김제시", "남원시", "익산시", "전주시", "정읍시", "고창군", "무주군", "부안군", "순창군", "완주군", "임실군", "장수군", "진안군"];
                        const jeju = ["서귀포시", "제주시", "남제주군", "북제주군"];
                        const chungnam = ["계룡시", "공주시", "금산군", "논산시", "당진시", "보령시", "부여군", "서산시", "서천군", "아산시", "예산군", "천안시 동남구", "천안시 서북구", "청양군", "태안군", "홍성군"];
                        const chungbuk = ["제천시", "청주시", "충주시", "괴산군", "단양군", "보은군", "영동군", "옥천군", "음성군", "증평군", "진천군", "청원군"];


                        if (e.value === "general01") {
                            add = gangwon;
                        } else if (e.value === "general02") {
                            add = gyeonggi;
                        } else if (e.value === "general03") {
                            add = gyeongsangnam;
                        } else if (e.value === "general04") {
                            add = gyeongsangbuk;
                        } else if (e.value === "general05") {
                            add = gwangju;
                        } else if (e.value === "general06") {
                            add = daegu;
                        } else if (e.value === "general07") {
                            add = daejeon;
                        } else if (e.value === "general08") {
                            add = busan;
                        } else if (e.value === "general09") {
                            add = seoul;
                        } else if (e.value === "general10") {
                            add = ulsan;
                        } else if (e.value === "general11") {
                            add = incheon;
                        } else if (e.value === "general12") {
                            add = jeonnam;
                        } else if (e.value === "general13") {
                            add = jeonbuk;
                        } else if (e.value === "general14") {
                            add = jeju;
                        } else if (e.value === "general15") {
                            add = chungnam;
                        } else if (e.value === "general16") {
                            add = chungbuk;
                        }

                        state.options.length = 1;
                        // 군/구 갯수;

                        for (property in add) {
                            let opt = document.createElement("option");
                            opt.value = add[property];
                            opt.innerHTML = add[property];
                            state.appendChild(opt);
                        }
                    }
                </script>
                <hr>
                <span id="left">&nbsp;<b>형태</b></span>
                <input type="radio" name="part">전체
                <input type="radio" name="part">셀프
                <hr>
                <span id="left">&nbsp;<b>상표</b>

                    <input type="checkbox" name="sk"><img src="/images/sk.png">
                    <input type="checkbox" name="asd"><img src="/images/gs.png">
                    <input type="checkbox" name="d"><img src="/images/hd.png">
                    <input type="checkbox" name="h"><img src="/images/so.png">
                    <input type="checkbox" name="f"><img src="/images/add.png">
                </span>
                <hr>
                <span id="left">&nbsp;<b>유종</b>
                    <input type="radio" name="oil" value="휘발유">휘발유
                    <input type="radio" name="oil" value="경유">경유
                    <br>
                    <input type="submit" value="조회" id="btn">
                </span>

            </div>
        </div>
        </form>
        <script>
            const toggleBtn = document.querySelector('.navbar__toggleBtn');
            const menu = document.querySelector('.navbar__menu');
            const sns = document.querySelector('.navbar__sns');

            toggleBtn.addEventListener('click', () => {
                menu.classList.toggle('active');
                sns.classList.toggle('active');
            });
        </script>
    </div>
    <div class="map_wrap" id="st">
        <div id="map"
            style="width:80%; height:150%; margin-top:-300px; float:right; padding-right: 10px;  border-radius: 20px;">
        </div>

        <div id="menu_wrap" class="bg_white">
            <div class="option">
                <div>
                    <form onsubmit="searchPlaces(); return false;">
                        키워드 : <input type="text" value="이태원 맛집" id="keyword" size="15">
                        <button type="submit">검색하기</button>
                    </form>
                </div>
            </div>
            <hr>
            <ul id="placesList"></ul>
            <div id="pagination"></div>
        </div>
    </div>

    <script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=7e64e250bab3db8a0b25fd29f3cc6e2e&libraries=services"></script>
    <script>
        // 마커를 담을 배열입니다
        var markers = [];

        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
            mapOption = {
                center: new kakao.maps.LatLng(37.566826, 126.9786567), // 지도의 중심좌표
                level: 3 // 지도의 확대 레벨
            };

        // 지도를 생성합니다    
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 장소 검색 객체를 생성합니다
        var ps = new kakao.maps.services.Places();

        // 검색 결과 목록이나 마커를 클릭했을 때 장소명을 표출할 인포윈도우를 생성합니다
        var infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });

        // 키워드로 장소를 검색합니다
        searchPlaces();

        // 키워드 검색을 요청하는 함수입니다
        function searchPlaces() {

            var keyword = document.getElementById('keyword').value;

            if (!keyword.replace(/^\s+|\s+$/g, '')) {
                alert('키워드를 입력해주세요!');
                return false;
            }

            // 장소검색 객체를 통해 키워드로 장소검색을 요청합니다
            ps.keywordSearch(keyword, placesSearchCB);
        }

        // 장소검색이 완료됐을 때 호출되는 콜백함수 입니다
        function placesSearchCB(data, status, pagination) {
            if (status === kakao.maps.services.Status.OK) {

                // 정상적으로 검색이 완료됐으면
                // 검색 목록과 마커를 표출합니다
                displayPlaces(data);

                // 페이지 번호를 표출합니다
                displayPagination(pagination);

            } else if (status === kakao.maps.services.Status.ZERO_RESULT) {

                alert('검색 결과가 존재하지 않습니다.');
                return;

            } else if (status === kakao.maps.services.Status.ERROR) {

                alert('검색 결과 중 오류가 발생했습니다.');
                return;

            }
        }

        // 검색 결과 목록과 마커를 표출하는 함수입니다
        function displayPlaces(places) {

            var listEl = document.getElementById('placesList'),
                menuEl = document.getElementById('menu_wrap'),
                fragment = document.createDocumentFragment(),
                bounds = new kakao.maps.LatLngBounds(),
                listStr = '';

            // 검색 결과 목록에 추가된 항목들을 제거합니다
            removeAllChildNods(listEl);

            // 지도에 표시되고 있는 마커를 제거합니다
            removeMarker();

            for (var i = 0; i < places.length; i++) {

                // 마커를 생성하고 지도에 표시합니다
                var placePosition = new kakao.maps.LatLng(places[i].y, places[i].x),
                    marker = addMarker(placePosition, i),
                    itemEl = getListItem(i, places[i]); // 검색 결과 항목 Element를 생성합니다

                // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
                // LatLngBounds 객체에 좌표를 추가합니다
                bounds.extend(placePosition);

                // 마커와 검색결과 항목에 mouseover 했을때
                // 해당 장소에 인포윈도우에 장소명을 표시합니다
                // mouseout 했을 때는 인포윈도우를 닫습니다
                (function (marker, title) {
                    kakao.maps.event.addListener(marker, 'mouseover', function () {
                        displayInfowindow(marker, title);
                    });

                    kakao.maps.event.addListener(marker, 'mouseout', function () {
                        infowindow.close();
                    });

                    itemEl.onmouseover = function () {
                        displayInfowindow(marker, title);
                    };

                    itemEl.onmouseout = function () {
                        infowindow.close();
                    };
                })(marker, places[i].place_name);

                fragment.appendChild(itemEl);
            }

            // 검색결과 항목들을 검색결과 목록 Element에 추가합니다
            listEl.appendChild(fragment);
            menuEl.scrollTop = 0;

            // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다
            map.setBounds(bounds);
        }

        // 검색결과 항목을 Element로 반환하는 함수입니다
        function getListItem(index, places) {

            var el = document.createElement('li'),
                itemStr = '<span class="markerbg marker_' + (index + 1) + '"></span>' +
                    '<div class="info">' +
                    '   <h5>' + places.place_name + '</h5>';

            if (places.road_address_name) {
                itemStr += '    <span>' + places.road_address_name + '</span>' +
                    '   <span class="jibun gray">' + places.address_name + '</span>';
            } else {
                itemStr += '    <span>' + places.address_name + '</span>';
            }

            itemStr += '  <span class="tel">' + places.phone + '</span>' +
                '</div>';

            el.innerHTML = itemStr;
            el.className = 'item';

            return el;
        }

        // 마커를 생성하고 지도 위에 마커를 표시하는 함수입니다
        function addMarker(position, idx, title) {
            var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png', // 마커 이미지 url, 스프라이트 이미지를 씁니다
                imageSize = new kakao.maps.Size(36, 37),  // 마커 이미지의 크기
                imgOptions = {
                    spriteSize: new kakao.maps.Size(36, 691), // 스프라이트 이미지의 크기
                    spriteOrigin: new kakao.maps.Point(0, (idx * 46) + 10), // 스프라이트 이미지 중 사용할 영역의 좌상단 좌표
                    offset: new kakao.maps.Point(13, 37) // 마커 좌표에 일치시킬 이미지 내에서의 좌표
                },
                markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imgOptions),
                marker = new kakao.maps.Marker({
                    position: position, // 마커의 위치
                    image: markerImage
                });

            marker.setMap(map); // 지도 위에 마커를 표출합니다
            markers.push(marker);  // 배열에 생성된 마커를 추가합니다

            return marker;
        }

        // 지도 위에 표시되고 있는 마커를 모두 제거합니다
        function removeMarker() {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(null);
            }
            markers = [];
        }

        // 검색결과 목록 하단에 페이지번호를 표시는 함수입니다
        function displayPagination(pagination) {
            var paginationEl = document.getElementById('pagination'),
                fragment = document.createDocumentFragment(),
                i;

            // 기존에 추가된 페이지번호를 삭제합니다
            while (paginationEl.hasChildNodes()) {
                paginationEl.removeChild(paginationEl.lastChild);
            }

            for (i = 1; i <= pagination.last; i++) {
                var el = document.createElement('a');
                el.href = "#";
                el.innerHTML = i;

                if (i === pagination.current) {
                    el.className = 'on';
                } else {
                    el.onclick = (function (i) {
                        return function () {
                            pagination.gotoPage(i);
                        }
                    })(i);
                }

                fragment.appendChild(el);
            }
            paginationEl.appendChild(fragment);
        }

        // 검색결과 목록 또는 마커를 클릭했을 때 호출되는 함수입니다
        // 인포윈도우에 장소명을 표시합니다
        function displayInfowindow(marker, title) {
            var content = '<div style="padding:5px;z-index:1;">' + title + '</div>';

            infowindow.setContent(content);
            infowindow.open(map, marker);
        }

        // 검색결과 목록의 자식 Element를 제거하는 함수입니다
        function removeAllChildNods(el) {
            while (el.hasChildNodes()) {
                el.removeChild(el.lastChild);
            }
        }
    </script>
</body>

</html>